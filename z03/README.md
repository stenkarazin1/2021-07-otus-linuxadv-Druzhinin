Настраиваем балансировку веб приложения

Цель:

Vagrantfile и ansible роль для развертывания серверов веб приложения под высокую нагрузку и отказоустойчивость

В работе должны применяться:

- keepalived,
- nginx,
- uwsgi/unicorn/php-fpm,
- некластеризованная бд mysql/mongodb/postgres/redis

Критерии оценки:

Статус "Принято" ставится при выполнении перечисленных требований

===============

Скрипт в Vagrantfile предназначен для создания двух виртуальных машин node1 и node2 с IP-адресами 10.0.8.2 и 10.0.8.3 соответственно и запуска playbook'а Ansible, создающего плавающий IP-адрес 10.0.8.8 и устанавливающего CMS Wordpress со всей необходимой инфраструктурой по аналогии с демо-вебинаром В.Дроздецкого "Ansible: быстрый старт // Бесплатный урок OTUS" youtube.com/watch?v=2p8y9wdsvVE

Разработка велась в следующей среде:
- VirtualBox Version: 6.1
- Guest Additions Version: 5.2.42
- Vagrant Version: 2.2.9
- Ansible Version: 2.8.14
- Python Version: 3.7.6

На виртуальные машины устанавливаются, в частности,
- Ubuntu Version: 18.04
- PHP Version: 7.2, при публикации в репозиториях Ubuntu другой версии PHP нужно изменить дефолтное значение переменной php_version роли php

1. Инсталляция Wordpress

Склонируйте репозиторий и установите Wordpress с необходимым окружением
$ git clone git@github.com:stenkarazin2/2021-07-otus-linuxadv-Druzhinin.git
$ cd 2021-07-otus-linuxadv-Druzhinin/z03
$ vagrant up

По окончании создания виртуальных машин команда ip a выведет информацию о сетевой конфигурации каждой из них. Убедитесь, что IP-адреса 10.0.8.2 и 10.0.8.8 отнесены к одному и тому же интерфейсу enp0s8 виртуальной машины node1

Введите в адресной строке браузера IP-адрес 10.0.8.8. Браузер загрузит парковочную страницу системы Wordpress, установленной на машине node1

Введите данные, необходимые для установки Wordpress, в соответствии с таблицей
Database Name 		wp
Username 		wpuser
Password 		12345
Database Host 		localhost
Table Prefix 		wp_
В остальные поля ввода введите любые значения по своему усмотрению, и инсталлируйте Wordpress из исходного PHP-кода на подготовленную инфраструктуру

Введите в адресной строке браузера IP-адрес 10.0.8.8 еще раз. Теперь браузер загрузит главную страницу системы Wordpress, установленной на машине node1



2. Проверка правильности работы keepalived

Для проверки правильности работы keepalived отключите интерфейс enp0s8 виртуальной машины node1:
$ vagrant ssh node1
$ sudo ifconfig enp0s8 down
Введите в адресной строке браузера IP-адрес 10.0.8.2 и убедитесь, что машина node1 теперь недоступна

Если теперь ввести в адресной строке браузера IP-адрес 10.0.8.8, то браузер загрузит парковочную страницу системы Wordpress, установленной на машине node2. А IP-адреса 10.0.8.3 и 10.0.8.8 отнесены к интерфейсу enp0s8 виртуальной машины node2, в чем можно убедиться, просмотрев сетевые настройки виртуальной машины node2:
$ vagrant ssh node2
$ ip a



3. Удаление

Удалите Wordpress и созданное для него окружение
$ vagrant destroy -f

